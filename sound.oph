; Copyright (C) 2014 David Boddie <david@boddie.org.uk>
;
; This program is free software: you can redistribute it and/or modify
; it under the terms of the GNU General Public License as published by
; the Free Software Foundation, either version 3 of the License, or
; (at your option) any later version.
;
; This program is distributed in the hope that it will be useful,
; but WITHOUT ANY WARRANTY; without even the implied warranty of
; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
; GNU General Public License for more details.
;
; You should have received a copy of the GNU General Public License
; along with this program.  If not, see <http://www.gnu.org/licenses/>.

sounds:
demise_sound:   .byte 1,0, 1,0, 160,0, 6,0      ; 6 * 50ms
item_sound:     .byte $13,0, 2,0, 160,0, 4,0    ; 4 * 50ms
jump_sound:     .byte $13,0, 3,0, 50,0, 2,0     ; 2 * 50ms
step_sound:     .byte $01,0, 241,0, 0,0, 1,0    ; 50ms
door_sound:     .byte $11,0, 4,0, 0,0, 4,0      ; 200ms
portal_sound:   .byte $11,0, 5,0, 10,0, 2,0     ; 100ms

play_sound:     ; X=sound number

    txa
    asl
    asl
    asl
    adc #<sounds
    tax
    lda #0
    adc #>sounds
    tay
    clc
    lda #7
    jsr $fff1

    rts

play_music: ; X=offset,Y=end

    sty $70

    play_music_loop:

        ldy notes,x
        sty [note_buffer + 4]

        txa
        pha

        play_music_note:

        lda #7
        ldx #<note_buffer
        ldy #>note_buffer
        jsr $fff1

        pla
        tax
        inx
        cpx $70
        bcc play_music_loop

    clc
    rts

.alias C4 4
.alias D4 12
.alias E4 20
.alias F4 24
.alias G4 32
.alias A4 40
.alias B4 48
.alias C5 52

.alias short 4
.alias long 8

note_buffer:
note_buffer_channel:   .byte 1,0
note_buffer_amplitude: .byte 240,255
note_buffer_pitch:     .byte 0,0
note_buffer_length:    .byte short,0

notes:
.byte C4, D4, C4, G4, E4, G4, C4, A4, F4, A4, D4, B4, G4, B4, E4, C5
.byte C5, C5, C5, B4, G4, B4, G4, A4, F4, A4, F4, G4, F4, E4, D4, C4
completed_notes_end:
game_over_notes:
.byte G4, A4, G4, A4, G4, F4, E4, D4, C4, C4
game_over_notes_end:

.alias completed_notes_length [completed_notes_end - notes]
.alias game_over_notes_start  [completed_notes_end - notes]
.alias game_over_notes_finish [game_over_notes_end - notes]
